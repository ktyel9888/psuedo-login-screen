<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ì•ˆ íŒŒì¼ ìŠ¤ìºë„ˆ</title>
    
    <style>
        /* ê¸°ë³¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
        }

        .container {
            text-align: center;
            background-color: #ffffff;
            padding: 40px 50px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #1a1a1a;
            margin-bottom: 30px;
        }

        /* ìŠ¤ìº” ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #scan-button {
            background-color: #007aff; /* íŒŒë€ìƒ‰ */
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }

        #scan-button:hover {
            background-color: #0056b3;
        }

        #scan-button:active {
            transform: scale(0.98);
        }

        /* -------------------------- */
        /* ì˜¤ë¥˜ íŒì—… ìŠ¤íƒ€ì¼ */
        /* -------------------------- */

        /* íŒì—… ë°°ê²½ (í™”ë©´ ì „ì²´ë¥¼ ì–´ë‘¡ê²Œ í•¨) */
        .modal-overlay {
            position: fixed; /* í™”ë©´ì— ê³ ì • */
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* ë°˜íˆ¬ëª… ê²€ì€ìƒ‰ */
            
            /* íŒì—…ì„ ì¤‘ì•™ì— ìœ„ì¹˜ì‹œí‚¤ê¸° ìœ„í•œ Flexbox */
            display: none; /* í‰ì†Œì—ëŠ” ìˆ¨ê¹€ */
            align-items: center;
            justify-content: center;
        }

        /* íŒì—… ìƒì ë³¸ì²´ */
        .modal-content {
            background-color: #ffffff;
            padding: 24px 32px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
        }

        .modal-content h2 {
            margin-top: 0;
            color: #d93025; /* ì˜¤ë¥˜ ìƒ‰ìƒ */
        }

        .modal-content p {
            font-size: 16px;
            color: #333;
            line-height: 1.5;
        }

        /* ë‹«ê¸° ë²„íŠ¼ (X) */
        .close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }

        .close-button:hover {
            color: #333;
        }

        /* íŒì—…ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•œ í´ë˜ìŠ¤ (JSì—ì„œ ì‚¬ìš©) */
        .modal-overlay.show {
            display: flex; /* Flexboxë¡œ ì¤‘ì•™ ì •ë ¬ */
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ë³´ì•ˆ íŒŒì¼ ìŠ¤ìºë„ˆ</h1>
        <p style="margin-top: -10px; margin-bottom: 30px; color: #555;">n8n ì›¹í›… í…ŒìŠ¤íŠ¸ í˜ì´ì§€</p>
        <button id="scan-button">íŒŒì¼ ìŠ¤ìº” ì‹œì‘</button>
    </div>

    <div id="error-overlay" class="modal-overlay">
        <div class="modal-content">
            <span class="close-button" onclick="closeErrorPopup()">&times;</span>
            <h2>ğŸš¨ ìŠ¤ìº” ì˜¤ë¥˜</h2>
            <p id="error-message-text">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>
        </div>
    </div>


    <script>
        // --------------------------
        // íŒì—… ì œì–´ í•¨ìˆ˜
        // --------------------------

        // íŒì—…ì„ ì—¬ëŠ” í•¨ìˆ˜
        function showErrorPopup(message) {
            const overlay = document.getElementById('error-overlay');
            const messageElement = document.getElementById('error-message-text');
            
            // ì˜¤ë¥˜ ë©”ì‹œì§€ ì„¤ì • (ê¸°ë³¸ê°’ ë˜ëŠ” íŠ¹ì • ë©”ì‹œì§€)
            messageElement.textContent = message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
            
            // 'show' í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ íŒì—…ì„ ë³´ì´ê²Œ í•¨
            overlay.classList.add('show');
        }

        // íŒì—…ì„ ë‹«ëŠ” í•¨ìˆ˜
        function closeErrorPopup() {
            const overlay = document.getElementById('error-overlay');
            
            // 'show' í´ë˜ìŠ¤ë¥¼ ì œê±°í•˜ì—¬ íŒì—…ì„ ìˆ¨ê¹€
            overlay.classList.remove('show');
        }

        // ì˜¤ë²„ë ˆì´(ë°°ê²½) í´ë¦­ ì‹œ ë‹«ê¸°
        window.addEventListener('click', function(event) {
            const overlay = document.getElementById('error-overlay');
            if (event.target == overlay) {
                closeErrorPopup();
            }
        });

        // --------------------------
        // n8n ì›¹í›… í˜¸ì¶œ (í•µì‹¬ ë¡œì§)
        // --------------------------

        // ìŠ¤ìº” ë²„íŠ¼ì— í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
        document.getElementById('scan-button').addEventListener('click', scanFile);

        async function scanFile() {
            // n8n ì›¹í›… ì£¼ì†Œ (ì˜¤ë¥˜ ë¡œê·¸ì—ì„œ ê°€ì ¸ì˜´)
            const webhookUrl = 'https://primary-production-b57a.up.railway.app/webhook/s3_public_test';
            
            // TODO: ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ íŒŒì¼ì„ ì½ê³  ë°ì´í„°ë¥¼ ì¤€ë¹„í•´ì•¼ í•©ë‹ˆë‹¤.
            // ì§€ê¸ˆì€ n8n ì›Œí¬í”Œë¡œìš°ë¥¼ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.
            const testData = {
                fileName: "test_file.txt",
                triggeredAt: new Date().toISOString()
            };

            console.log('n8nìœ¼ë¡œ ì›¹í›… ì „ì†¡ ì‹œë„...', webhookUrl);

            try {
                // n8n ì„œë²„ë¡œ fetch ìš”ì²­
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    body: JSON.stringify(testData),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    // ì„œë²„ê°€ 2xx ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•˜ì§€ ì•Šì€ ê²½ìš°
                    throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
                }

                const result = await response.json();
                console.log("ìŠ¤ìº” ê²°ê³¼ (ì„±ê³µ):", result);
                
                // ì„±ê³µ ì‹œ (ì˜ˆ: PIIê°€ ìˆë“  ì—†ë“  ì‘ë‹µì„ ë°›ìœ¼ë©´)
                alert('ìŠ¤ìº” ì„±ê³µ! \n' + JSON.stringify(result));

            } catch (error) {
                // *** ì˜¤ë¥˜ ë°œìƒ ì‹œ (CORS í¬í•¨) ***
                console.error('Error sending webhook:', error);
                
                let userMessage = 'íŒŒì¼ ìŠ¤ìº” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
                
                // CORS ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ê°ì§€
                if (error instanceof TypeError && error.message.includes('Failed to fetch')) {
                    userMessage = 'ìŠ¤ìº” ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (CORS ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ì˜ì‹¬ë©ë‹ˆë‹¤)';
                }
                
                // ìš°ë¦¬ê°€ ë§Œë“  ì˜¤ë¥˜ íŒì—… í•¨ìˆ˜ í˜¸ì¶œ
                showErrorPopup(userMessage);
            }
        }
    </script>

</body>
</html>