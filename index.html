<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PII ìœ ì¶œ íƒì§€ ìŠ¤ìºë„ˆ (Demo)</title>
    <script src="https://cdn.tailwindcss.com">
        // íŒì—…ì„ ì—¬ëŠ” í•¨ìˆ˜
function showErrorPopup(message) {
  const overlay = document.getElementById('error-overlay');
  const messageElement = document.getElementById('error-message-text');
  
  // ì˜¤ë¥˜ ë©”ì‹œì§€ ì„¤ì • (ê¸°ë³¸ê°’ ë˜ëŠ” íŠ¹ì • ë©”ì‹œì§€)
  messageElement.textContent = message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
  
  // 'show' í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ íŒì—…ì„ ë³´ì´ê²Œ í•¨
  overlay.classList.add('show');
}

// íŒì—…ì„ ë‹«ëŠ” í•¨ìˆ˜
function closeErrorPopup() {
  const overlay = document.getElementById('error-overlay');
  
  // 'show' í´ë˜ìŠ¤ë¥¼ ì œê±°í•˜ì—¬ íŒì—…ì„ ìˆ¨ê¹€
  overlay.classList.remove('show');
}

// ì˜¤ë²„ë ˆì´(ë°°ê²½) í´ë¦­ ì‹œ ë‹«ê¸° (ì„ íƒ ì‚¬í•­)
window.addEventListener('click', function(event) {
  const overlay = document.getElementById('error-overlay');
  if (event.target == overlay) {
    closeErrorPopup();
  }
});
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .drop-zone { border: 2px dashed #cbd5e1; transition: all 0.3s ease; }
        .drop-zone.dragover { border-color: #3b82f6; background-color: #eff6ff; }
        .loader { border-top-color: #3498db; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); }
        /* íŒì—… ë°°ê²½ (í™”ë©´ ì „ì²´ë¥¼ ì–´ë‘¡ê²Œ í•¨) */
.modal-overlay {
  display: none; /* í‰ì†Œì—ëŠ” ìˆ¨ê¹€ */
  position: fixed; /* í™”ë©´ì— ê³ ì • */
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6); /* ë°˜íˆ¬ëª… ê²€ì€ìƒ‰ */
  
  /* íŒì—…ì„ ì¤‘ì•™ì— ìœ„ì¹˜ì‹œí‚¤ê¸° ìœ„í•œ Flexbox */
  display: none;
  align-items: center;
  justify-content: center;
}

/* íŒì—… ìƒì ë³¸ì²´ */
.modal-content {
  background-color: #ffffff;
  padding: 24px 32px;
  border-radius: 8px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  width: 90%;
  max-width: 400px;
  text-align: center;
  position: relative;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

.modal-content h2 {
  margin-top: 0;
  color: #d93025; /* ì˜¤ë¥˜ ìƒ‰ìƒ */
}

.modal-content p {
  font-size: 16px;
  color: #333;
  line-height: 1.5;
}

/* ë‹«ê¸° ë²„íŠ¼ (X) */
.close-button {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 28px;
  font-weight: bold;
  color: #aaa;
  cursor: pointer;
}

.close-button:hover {
  color: #333;
}

/* íŒì—…ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•œ í´ë˜ìŠ¤ (JSì—ì„œ ì‚¬ìš©) */
.modal-overlay.show {
  display: flex; /* Flexboxë¡œ ì¤‘ì•™ ì •ë ¬ */
}
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    
    <!-- ë©”ì¸ ì—…ë¡œë“œ í™”ë©´ -->
    <div class="w-full max-w-2xl p-8 bg-white rounded-lg shadow-xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">ë³´ì•ˆ íŒŒì¼ ìŠ¤ìºë„ˆ</h1>
        <p class="text-center text-gray-600 mb-8">Upstage AI Agentê°€ íŒŒì¼ì„ ìŠ¤ìº”í•˜ì—¬ ê°œì¸ì •ë³´(PII) í¬í•¨ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>

        <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">ìŠ¤ìº”í•  íŒŒì¼:</label>
            <div id="dropZone" class="drop-zone w-full p-10 text-center rounded-lg cursor-pointer hover:bg-gray-50">
                <input type="file" id="fileInput" class="hidden">
                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
                <p class="mt-2 text-sm text-gray-600">ìŠ¤ìº”í•  íŒŒì¼ì„ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”.</p>
                <p id="fileName" class="text-sm text-blue-600 font-medium mt-2"></p>
            </div>
        </div>

        <!-- Webhook ì „ì†¡ ë²„íŠ¼ -->
        <div class="mb-4">
            <button id="scanButton" onclick="scanFile()" class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 transition duration-300 font-bold flex items-center justify-center">
                <span id="buttonText">íŒŒì¼ ìŠ¤ìº” ì‹œì‘</span>
                <div id="loader" class="loader w-5 h-5 rounded-full border-2 border-t-blue-600 border-white ml-3 hidden"></div>
            </button>
        </div>
        
        <!-- ê²°ê³¼ ë©”ì‹œì§€ í‘œì‹œ -->
        <div id="result" class="text-center text-sm h-5"></div>
    </div>

    <!-- PII íƒì§€ ì‹œ ê²½ê³  íŒì—… (ëª¨ë‹¬) -->
    <div id="alertModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full mx-4 transform transition-all scale-95 opacity-0" id="modalContent">
            <div class="text-center">
                <!-- ê²½ê³  ì•„ì´ì½˜ -->
                <div class="mx-auto flex items-center justify-center h-24 w-24 rounded-full bg-red-100 mb-4">
                    <svg class="h-16 w-16 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.01" />
                    </svg>
                </div>
                <!-- ê²½ê³  ì œëª© -->
                <h3 class="text-3xl font-bold text-gray-900">ê²½ê³ : PII íƒì§€</h3>
                <!-- ê²½ê³  ë‚´ìš© -->
                <div class="mt-4">
                    <p class="text-lg text-gray-600">
                        íŒŒì¼ ì—…ë¡œë“œ ì‹œë®¬ë ˆì´ì…˜ì—ì„œ ê°œì¸ì •ë³´(PII)ê°€ íƒì§€ë˜ì—ˆìŠµë‹ˆë‹¤.
                    </p>
                    <p class="text-md text-gray-500 mt-2">
                        (n8n ì›Œí¬í”Œë¡œìš°ê°€ 'true'ë¥¼ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤.)
                    </p>
                </div>
            </div>
            <!-- ë‹«ê¸° ë²„íŠ¼ -->
            <div class="mt-8">
                <button onclick="closeModal()" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">
                    í™•ì¸ (ë‹«ê¸°)
                </button>
            </div>
        </div>
    </div>


    <script>
        // --- n8n Webhook URL (ì‚¬ìš©ìê°€ ì œê³µí•œ URL) ---
        const N8N_WEBHOOK_URL = "https://primary-production-b57a.up.railway.app/webhook/s3_public_test";

        // --- íŒŒì¼ ì—…ë¡œë“œ UI ë¡œì§ ---
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileNameDisplay = document.getElementById('fileName');

        dropZone.onclick = () => fileInput.click();
        
        fileInput.onchange = (e) => {
            if (e.target.files.length > 0) {
                fileNameDisplay.textContent = e.target.files[0].name;
                document.getElementById('result').innerHTML = ''; // ì´ì „ ê²°ê³¼ ì´ˆê¸°í™”
            }
        };

        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('dragover'); };
        dropZone.ondragleave = () => { dropZone.classList.remove('dragover'); };
        dropZone.ondrop = (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                fileInput.files = e.dataTransfer.files;
                fileNameDisplay.textContent = e.dataTransfer.files[0].name;
                document.getElementById('result').innerHTML = ''; // ì´ì „ ê²°ê³¼ ì´ˆê¸°í™”
            }
        };

        // --- Webhook ì „ì†¡ í•¨ìˆ˜ ---
        async function scanFile() {
            const file = fileInput.files[0];
            const resultDiv = document.getElementById('result');
            const scanButton = document.getElementById('scanButton');
            const buttonText = document.getElementById('buttonText');
            const loader = document.getElementById('loader');
            
            if (!file) {
                resultDiv.innerHTML = '<span class="text-red-500">íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.</span>';
                return;
            }

            // ë¡œë”© ìƒíƒœ ì‹œì‘
            resultDiv.innerHTML = '<span class="text-gray-500">n8n ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¤‘... (ì‘ë‹µ ëŒ€ê¸°)</span>';
            scanButton.disabled = true;
            buttonText.textContent = 'ìŠ¤ìº” ì¤‘...';
            loader.classList.remove('hidden');

            // n8nì˜ 'Parse Event' ë…¸ë“œë¥¼ í†µê³¼ì‹œí‚¤ê¸° ìœ„í•œ 'ê°€ì§œ S3 ì´ë²¤íŠ¸' JSON
            // ì´ JSONì´ 'isPublic = true'ë¥¼ ë§Œë“­ë‹ˆë‹¤.
            const fakeS3EventPayload = {
              "detail": {
                "eventName": "PutBucketPolicy",
                "requestParameters": {
                  "bucketName": "demo-bucket-for-pii",
                  "bucketPolicy": {
                    "Statement": [
                      {
                        "Effect": "Allow",
                        "Principal": "*", // <-- ì´ ë¶€ë¶„ì´ 'isPublic = true'ë¥¼ ë§Œë“­ë‹ˆë‹¤.
                        "Action": "s3:GetObject",
                        "Resource": "arn:aws:s3:::demo-bucket-for-pii/*"
                      }
                    ]
                  }
                }
              }
            };

            try {
                // n8n Webhookìœ¼ë¡œ 'ê°€ì§œ S3 ì´ë²¤íŠ¸' JSON ì „ì†¡
                // (ì„ íƒí•œ íŒŒì¼ì€ ì „ì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í˜„ì¬ ì›Œí¬í”Œë¡œìš°ëŠ” íŒŒì¼ ìŠ¤ìº” ê¸°ëŠ¥ì´ ì—†ìŠµë‹ˆë‹¤.)
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(fakeS3EventPayload)
                });

                if (!response.ok) {
                    throw new Error(`n8n ì„œë²„ ì˜¤ë¥˜: ${response.statusText}`);
                }

                // n8nì´ ë°˜í™˜í•œ JSON ê²°ê³¼ë¥¼ íŒŒì‹±
                // (ìˆ˜ì •ëœ ì›Œí¬í”Œë¡œìš°ëŠ” { "pii_detected": true } ë˜ëŠ” { "pii_detected": false } ë¥¼ ë°˜í™˜)
                const n8nResult = await response.json();

                // n8nì˜ ì‘ë‹µì— ë”°ë¼ ë¶„ê¸°
                if (n8nResult.pii_detected === true) {
                    // PIIê°€ íƒì§€ë˜ë©´ ê²½ê³  íŒì—…(ëª¨ë‹¬) í‘œì‹œ
                    resultDiv.innerHTML = '<span class="text-red-500">PII íƒì§€! (ê²½ê³  íŒì—… í™•ì¸)</span>';
                    showModal();
                } else {
                    // PIIê°€ ì—†ìœ¼ë©´ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                    resultDiv.innerHTML = '<span class="text-green-600">ìŠ¤ìº” ì™„ë£Œ: PIIê°€ íƒì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. (ì•ˆì „)</span>';
                }

            } catch (error) {
                console.error('Error sending webhook:', error);
                // fetch ìì²´ê°€ ì‹¤íŒ¨í•œ ê²½ìš° (CORS ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜)
                resultDiv.innerHTML = `<span class="text-red-500">ìŠ¤ìº” ì˜¤ë¥˜: ${error.message}. (CORS ì„¤ì • í™•ì¸)</span>`;
            } finally {
                // ë¡œë”© ìƒíƒœ ì¢…ë£Œ
                scanButton.disabled = false;
                buttonText.textContent = 'íŒŒì¼ ìŠ¤ìº” ì‹œì‘';
                loader.classList.add('hidden');
            }
        }

        // --- ëª¨ë‹¬(íŒì—…) ì œì–´ í•¨ìˆ˜ ---
        const alertModal = document.getElementById('alertModal');
        const modalContent = document.getElementById('modalContent');

        function showModal() {
            alertModal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 50); // ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
        }

        function closeModal() {
            modalContent.classList.add('scale-95', 'opacity-0');
            modalContent.classList.remove('scale-100', 'opacity-100');
            setTimeout(() => {
                alertModal.classList.add('hidden');
            }, 300); // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„
        }
    </script>
    <div id="error-overlay" class="modal-overlay">
  <div class="modal-content">
    <span class="close-button" onclick="closeErrorPopup()">&times;</span>
    <h2>ğŸš¨ ìŠ¤ìº” ì˜¤ë¥˜</h2>
    <p id="error-message-text">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>
  </div>
</div>
</body>
</html>